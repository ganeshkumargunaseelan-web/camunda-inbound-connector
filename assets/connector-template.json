{
  "$schema": "https://unpkg.com/@camunda/zeebe-element-templates-json-schema/resources/schema.json",
  "name": "Inbound Messaging Connector",
  "id": "io.camunda.connector.inbound.messaging",
  "version": 1,
  "description": "Receive messages from WhatsApp, Telegram, and SMS channels with Arabic text support",
  "documentationRef": "https://github.com/ganeshkumargunaseelan-web/camunda-inbound-connector",
  "category": {
    "id": "connectors",
    "name": "Connectors"
  },
  "appliesTo": [
    "bpmn:StartEvent",
    "bpmn:IntermediateCatchEvent"
  ],
  "elementType": {
    "value": "bpmn:StartEvent",
    "eventDefinition": "bpmn:MessageEventDefinition"
  },
  "groups": [
    {
      "id": "channel",
      "label": "Channel Configuration"
    },
    {
      "id": "routing",
      "label": "Message Routing"
    },
    {
      "id": "arabic",
      "label": "Arabic Processing"
    },
    {
      "id": "correlation",
      "label": "Correlation"
    },
    {
      "id": "output",
      "label": "Output Mapping"
    }
  ],
  "properties": [
    {
      "type": "Hidden",
      "value": "io.camunda:inbound-messaging:1",
      "binding": {
        "type": "zeebe:taskDefinition:type"
      }
    },
    {
      "id": "channelType",
      "label": "Channel Type",
      "description": "Select the messaging channel",
      "group": "channel",
      "type": "Dropdown",
      "choices": [
        { "name": "WhatsApp Business API", "value": "whatsapp" },
        { "name": "Telegram Bot", "value": "telegram" },
        { "name": "SMS - Unifonic", "value": "sms_unifonic" },
        { "name": "SMS - Infobip", "value": "sms_infobip" },
        { "name": "SMS - STC Business", "value": "sms_stc" },
        { "name": "SMS - Etisalat (e&)", "value": "sms_etisalat" }
      ],
      "binding": {
        "type": "zeebe:property",
        "name": "channelType"
      },
      "constraints": {
        "notEmpty": true
      }
    },
    {
      "id": "webhookPath",
      "label": "Webhook Path",
      "description": "Custom webhook path suffix (optional)",
      "group": "channel",
      "type": "String",
      "feel": "optional",
      "binding": {
        "type": "zeebe:property",
        "name": "webhookPath"
      },
      "optional": true
    },
    {
      "id": "verifyToken",
      "label": "Verify Token",
      "description": "Token for webhook verification (WhatsApp/Telegram)",
      "group": "channel",
      "type": "String",
      "feel": "optional",
      "binding": {
        "type": "zeebe:property",
        "name": "verifyToken"
      },
      "condition": {
        "property": "channelType",
        "oneOf": ["whatsapp", "telegram"]
      },
      "optional": true
    },
    {
      "id": "routingKeywords",
      "label": "Routing Keywords",
      "description": "Keywords to match for routing (comma-separated, supports Arabic)",
      "group": "routing",
      "type": "String",
      "feel": "optional",
      "binding": {
        "type": "zeebe:property",
        "name": "routingKeywords"
      },
      "optional": true
    },
    {
      "id": "routingPattern",
      "label": "Routing Pattern",
      "description": "Regex pattern for message routing",
      "group": "routing",
      "type": "String",
      "feel": "optional",
      "binding": {
        "type": "zeebe:property",
        "name": "routingPattern"
      },
      "optional": true
    },
    {
      "id": "routingPriority",
      "label": "Routing Priority",
      "description": "Priority for this route (higher = more priority)",
      "group": "routing",
      "type": "String",
      "feel": "optional",
      "value": "100",
      "binding": {
        "type": "zeebe:property",
        "name": "routingPriority"
      }
    },
    {
      "id": "normalizeArabic",
      "label": "Normalize Arabic Text",
      "description": "Enable Arabic text normalization before routing",
      "group": "arabic",
      "type": "Boolean",
      "value": true,
      "binding": {
        "type": "zeebe:property",
        "name": "normalizeArabic"
      }
    },
    {
      "id": "removeDiacritics",
      "label": "Remove Diacritics (Tashkeel)",
      "description": "Remove Arabic diacritical marks",
      "group": "arabic",
      "type": "Boolean",
      "value": true,
      "binding": {
        "type": "zeebe:property",
        "name": "removeDiacritics"
      }
    },
    {
      "id": "normalizeHamza",
      "label": "Normalize Hamza",
      "description": "Normalize all hamza forms to base alef (أ إ آ → ا)",
      "group": "arabic",
      "type": "Boolean",
      "value": true,
      "binding": {
        "type": "zeebe:property",
        "name": "normalizeHamza"
      }
    },
    {
      "id": "convertNumerals",
      "label": "Convert Eastern Numerals",
      "description": "Convert Eastern Arabic numerals to Western (٠١٢ → 012)",
      "group": "arabic",
      "type": "Boolean",
      "value": true,
      "binding": {
        "type": "zeebe:property",
        "name": "convertNumerals"
      }
    },
    {
      "id": "detectLocale",
      "label": "Auto-Detect GCC Locale",
      "description": "Detect locale from phone prefix (+966=SA, +971=AE, etc.)",
      "group": "arabic",
      "type": "Boolean",
      "value": true,
      "binding": {
        "type": "zeebe:property",
        "name": "detectLocale"
      }
    },
    {
      "id": "correlationEnabled",
      "label": "Enable Correlation",
      "description": "Correlate messages to running process instances",
      "group": "correlation",
      "type": "Boolean",
      "value": false,
      "binding": {
        "type": "zeebe:property",
        "name": "correlationEnabled"
      }
    },
    {
      "id": "correlationKey",
      "label": "Correlation Key Expression",
      "description": "Expression to extract correlation key (e.g., senderPhone)",
      "group": "correlation",
      "type": "String",
      "feel": "required",
      "value": "=senderPhone",
      "binding": {
        "type": "zeebe:property",
        "name": "correlationKey"
      },
      "condition": {
        "property": "correlationEnabled",
        "equals": true
      }
    },
    {
      "id": "messageName",
      "label": "Message Name",
      "description": "Name for message correlation",
      "group": "correlation",
      "type": "String",
      "feel": "optional",
      "binding": {
        "type": "bpmn:Message#property",
        "name": "name"
      },
      "condition": {
        "property": "correlationEnabled",
        "equals": true
      }
    },
    {
      "id": "resultVariable",
      "label": "Result Variable",
      "description": "Name of variable to store the message data",
      "group": "output",
      "type": "String",
      "value": "inboundMessage",
      "binding": {
        "type": "zeebe:property",
        "name": "resultVariable"
      }
    },
    {
      "id": "resultExpression",
      "label": "Result Expression",
      "description": "Expression to map message data to process variables",
      "group": "output",
      "type": "Text",
      "feel": "required",
      "value": "={\n  messageId: response.messageId,\n  channel: response.channel,\n  senderPhone: response.sender.phone,\n  senderName: response.sender.name,\n  messageText: response.content.text,\n  normalizedText: response.content.normalizedText,\n  locale: response.sender.detectedLocale,\n  timestamp: response.timestamp,\n  hasMedia: response.content.hasMedia\n}",
      "binding": {
        "type": "zeebe:property",
        "name": "resultExpression"
      }
    }
  ],
  "icon": {
    "contents": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200' width='18' height='18'%3E%3Cdefs%3E%3ClinearGradient id='bgGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%230a1628;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%231a2d4a;stop-opacity:1' /%3E%3C/linearGradient%3E%3ClinearGradient id='accentGrad' x1='0%25' y1='0%25' x2='100%25' y2='0%25'%3E%3Cstop offset='0%25' style='stop-color:%2300d4aa;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%2300f5cc;stop-opacity:1' /%3E%3C/linearGradient%3E%3ClinearGradient id='orangeGrad' x1='0%25' y1='0%25' x2='100%25' y2='0%25'%3E%3Cstop offset='0%25' style='stop-color:%23ff6b35;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23ff9f1c;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='100' cy='100' r='95' fill='url(%23bgGrad)' stroke='url(%23accentGrad)' stroke-width='2'/%3E%3Cg transform='translate(35, 40)'%3E%3Crect x='0' y='20' width='70' height='45' rx='8' fill='url(%23accentGrad)' opacity='0.9'/%3E%3Ccircle cx='20' cy='42' r='5' fill='%230a1628'/%3E%3Ccircle cx='35' cy='42' r='5' fill='%230a1628'/%3E%3Ccircle cx='50' cy='42' r='5' fill='%230a1628'/%3E%3Crect x='60' y='0' width='70' height='45' rx='8' fill='url(%23orangeGrad)' opacity='0.9'/%3E%3Crect x='72' y='15' width='45' height='4' rx='2' fill='%230a1628'/%3E%3Crect x='72' y='25' width='35' height='4' rx='2' fill='%230a1628'/%3E%3C/g%3E%3Cg transform='translate(100, 115)'%3E%3Cpath d='M-30 0 L0 25 L30 0 L20 0 L20 -20 L-20 -20 L-20 0 Z' fill='url(%23accentGrad)' opacity='0.9'/%3E%3C/g%3E%3Cg transform='translate(100, 155)'%3E%3Ccircle cx='0' cy='0' r='18' fill='none' stroke='url(%23orangeGrad)' stroke-width='3'/%3E%3Ccircle cx='0' cy='0' r='8' fill='url(%23orangeGrad)'/%3E%3Crect x='-3' y='-22' width='6' height='8' fill='url(%23orangeGrad)'/%3E%3Crect x='-3' y='14' width='6' height='8' fill='url(%23orangeGrad)'/%3E%3Crect x='-22' y='-3' width='8' height='6' fill='url(%23orangeGrad)'/%3E%3Crect x='14' y='-3' width='8' height='6' fill='url(%23orangeGrad)'/%3E%3C/g%3E%3C/svg%3E"
  }
}
